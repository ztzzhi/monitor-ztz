{"code":"import { createRouterEvent } from \"../utils/createRouterEvent\";\nimport { reportTracker } from \"./reportTracker\";\nconst _window = window;\nclass Monitor {\n    constructor(options) {\n        this.options = options;\n        _window.Monitor = {\n            _requestUrl_: this.options.requestUrl,\n            _addId_: this.options.appId,\n        };\n        this.pageStartTime = this.getTime();\n        this.currentPage = _window.location.href;\n        this.addEventListener();\n        if (this.options.routerTracker) {\n            this.installRouterTracker();\n        }\n    }\n    static getInstance() { }\n    // 添加监听事件\n    addEventListener() {\n        _window.history[\"pushState\"] = createRouterEvent(\"pushState\");\n        _window.history[\"replaceState\"] = createRouterEvent(\"replaceState\");\n    }\n    // 监听路由变化统计pv\n    installRouterTracker() {\n        this.getStayTime();\n    }\n    // 统计页面停留时长\n    getStayTime() {\n        [\"hashchange\", \"pushState\", \"replaceState\", \"popstate\"].forEach((item) => {\n            _window.addEventListener(item, (event) => {\n                let currentPage = _window.location.href;\n                if (currentPage === this.currentPage)\n                    return;\n                this.currentPage = currentPage;\n                let stayTime = this.calcStayTime() / 1000;\n                if (stayTime > 0.2) {\n                    this.pageStartTime = this.getTime();\n                    // 上报数据\n                    reportTracker({\n                        stayTime,\n                        currentPage,\n                    }, \"PV\");\n                }\n            });\n        });\n    }\n    getTime() {\n        return new Date().getTime();\n    }\n    calcStayTime() {\n        return this.getTime() - this.pageStartTime;\n    }\n    setUserId(id) {\n        this.userId = id;\n    }\n}\n_window.Monitor = Monitor;\nexport { Monitor as default, reportTracker };\n","references":["/Users/ztz/myPro/ztz-monitor/src/types/index.ts","/Users/ztz/myPro/ztz-monitor/src/utils/createRouterEvent.ts","/Users/ztz/myPro/ztz-monitor/src/core/reportTracker.ts"]}
